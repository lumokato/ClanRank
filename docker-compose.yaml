# ==============================================================================
# 项目: ClanRank
# ==============================================================================
# 部署方式: 
#   服务器上 git clone 后 docker compose up -d --build
#   或 Portainer -> Stacks -> Add Stack -> Repository (GitHub)
#
# 环境变量 (通过 .env 文件或 Portainer Environment variables 填入):
#   - DOMAIN_NAME:     服务域名
#   - NETWORK_NAME:    Traefik所在的网络名
#   - HOST_DATA_PATH:  宿主机数据挂载根目录
#
# 首次部署前，需在宿主机创建配置目录并放入配置文件:
#   mkdir -p ${HOST_DATA_PATH}/clanrank/config
#   # 将 account.json, config.json, version.txt 放入该目录
# ==============================================================================

services:
  app-clanrank:
    build: .
    image: app-clanrank:latest
    container_name: app-clanrank
    restart: unless-stopped
    
    volumes:
      - ${HOST_DATA_PATH}/qd:/qd
      - ${HOST_DATA_PATH}/clanrank/config:/app/config
    
    # 网络设置
    networks:
      - traefik_net
    
    # Traefik 标签配置
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.autopcr.rule=Host(`${DOMAIN_NAME}`)" 
      - "traefik.http.routers.autopcr.entrypoints=websecure"
      - "traefik.http.routers.autopcr.tls.certresolver=letsencrypt"
      - "traefik.http.services.autopcr.loadbalancer.server.port=8000"

networks:
  traefik_net:
    external: true
    name: ${NETWORK_NAME}
